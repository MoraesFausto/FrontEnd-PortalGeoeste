{"ast":null,"code":"import _slicedToArray from\"/home/f4ustx/cnpq/Portal_Geoeste/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import axios from\"axios\";import React,{useState}from\"react\";import{DateTime}from\"luxon\";import{useDownload}from\"../../hooks/useDownload\";import{Button,ButtonState}from\"./Button\";import{Alert,Container}from\"react-bootstrap\";import{DownloadBtn}from\"./style\";import{Navigate}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Download(args){var path=\"/api/Data/mapas/\"+String(args.id)+\"/download\";if(args.downloadType===\"publication\")path=\"/api/Data/publications/download/\"+String(args.id);var DownloadFile=function DownloadFile(){var _useState=useState(ButtonState.Primary),_useState2=_slicedToArray(_useState,2),buttonState=_useState2[0],setButtonState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showAlert=_useState4[0],setShowAlert=_useState4[1];var preDownloading=function preDownloading(){return setButtonState(ButtonState.Loading);};var postDownloading=function postDownloading(){return setButtonState(ButtonState.Primary);};var onErrorDownloadFile=function onErrorDownloadFile(){setButtonState(ButtonState.Primary);setShowAlert(true);setTimeout(function(){setShowAlert(false);},3000);};var getFileName=function getFileName(){if(args.downloadType===\"publication\")return DateTime.local().toISODate()+\"-\"+String(args.title)+\".pdf\";return DateTime.local().toISODate()+String(args.id)+\".zip\";};var downloadFile=function downloadFile(){return axios.get(path,{responseType:\"blob\",headers:{authorization:\"Bearer \"+args.token// add authentication information as required by the backend APIs.\n}});};var _useDownload=useDownload({apiDefinition:downloadFile,preDownloading:preDownloading,postDownloading:postDownloading,onError:onErrorDownloadFile,getFileName:getFileName}),ref=_useDownload.ref,url=_useDownload.url,download=_useDownload.download,name=_useDownload.name;return/*#__PURE__*/_jsxs(Container,{className:\"mt-5\",children:[/*#__PURE__*/_jsx(Alert,{variant:\"danger\",show:showAlert,children:/*#__PURE__*/_jsx(Navigate,{to:\"/login\"})}),/*#__PURE__*/_jsxs(DownloadBtn,{p:args.pos,l:args.lef,children:[/*#__PURE__*/_jsx(\"a\",{href:url,download:name,className:\"hidden\",ref:ref}),/*#__PURE__*/_jsx(\"div\",{style:{\"marginLeft\":\"32%\"},children:/*#__PURE__*/_jsx(Button,{label:\"Download\",buttonState:buttonState,onClick:download})})]})]});};return/*#__PURE__*/_jsx(DownloadFile,{});};export default Download;","map":{"version":3,"names":["axios","React","useState","DateTime","useDownload","Button","ButtonState","Alert","Container","DownloadBtn","Navigate","Download","args","path","String","id","downloadType","DownloadFile","Primary","buttonState","setButtonState","showAlert","setShowAlert","preDownloading","Loading","postDownloading","onErrorDownloadFile","setTimeout","getFileName","local","toISODate","title","downloadFile","get","responseType","headers","authorization","token","apiDefinition","onError","ref","url","download","name","pos","lef"],"sources":["/home/f4ustx/cnpq/Portal_Geoeste/client/src/components/Button/DownloadFile.tsx"],"sourcesContent":["import axios from \"axios\";\nimport React, { useState } from \"react\";\nimport { DateTime } from \"luxon\";\nimport { useDownload } from \"../../hooks/useDownload\";\nimport { Button, ButtonState } from \"./Button\";\nimport { Alert, Container } from \"react-bootstrap\";\nimport { DownloadBtn } from \"./style\";\nimport { Navigate } from \"react-router-dom\";\nimport { IDownloadProps } from \"../../interfaces\";\n\nfunction Download(args: IDownloadProps) {\n  var path = \"/api/Data/mapas/\"+ String(args.id) + \"/download\"\n  if(args.downloadType === \"publication\")\n    path = \"/api/Data/publications/download/\"+ String(args.id)\n  \n  const DownloadFile: React.FC = () => {\n  const [buttonState, setButtonState] = useState<ButtonState>(\n    ButtonState.Primary\n  );\n  const [showAlert, setShowAlert] = useState<boolean>(false);\n\n  const preDownloading = () => setButtonState(ButtonState.Loading);\n  const postDownloading = () => setButtonState(ButtonState.Primary);\n\n  const onErrorDownloadFile = () => {\n    setButtonState(ButtonState.Primary);\n    setShowAlert(true);\n    setTimeout(() => {\n      setShowAlert(false);\n    }, 3000);\n  };\n\n  const getFileName = () => {\n    if(args.downloadType === \"publication\")\n      return DateTime.local().toISODate() + \"-\" + String(args.title) + \".pdf\";\n    return DateTime.local().toISODate() + String(args.id) + \".zip\";\n  };\n\n  const downloadFile = () => {\n    \n    return axios.get(\n      path,\n      {\n        responseType: \"blob\",\n         \n        headers: {\n          authorization: \"Bearer \" + args.token, // add authentication information as required by the backend APIs.\n        }\n         \n      }\n    );\n  };\n\n  const { ref, url, download, name } = useDownload({\n    apiDefinition: downloadFile,\n    preDownloading,\n    postDownloading,\n    onError: onErrorDownloadFile,\n    getFileName,\n  });\n\n  return (\n    <Container className=\"mt-5\">\n      <Alert variant=\"danger\" show={showAlert}>\n        <Navigate to='/login'/>\n      </Alert>\n      <DownloadBtn p={args.pos} l={args.lef}>\n      <a href={url} download={name} className=\"hidden\" ref={ref}/>\n      <div style={{\"marginLeft\":\"32%\"}}>\n      <Button label=\"Download\" buttonState={buttonState} onClick={download}/>\n      </div>\n      </DownloadBtn>\n    </Container>\n  );\n}\nreturn (<DownloadFile/>)\n};\n\nexport default Download;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}